// For conference and workshop schedule
//dateStr is expected in the format 2015-07-16", then returns "Thu Jul 16 2015"
function parseJson(e){var t=e.schedule,s=[],n=[],o=0,i=0;t.forEach(function(e,t,a){var r=[];a[t].date=getDateString(e.date),a[t].tableid="table-"+t,e.slots.forEach(function(e,s,n){var o=e.sessions;s===0&&(a[t].start=getIST(getTimeString(e.sessions[0].start))),s===n.length-1&&(a[t].end=getIST(getTimeString(e.sessions[o.length-1].end))),o.forEach(function(e,n){e.section_name&&e.section_name.toLowerCase().indexOf("workshop")!==-1&&(a[t].type="workshop"),e.room&&r.indexOf(e.room)===-1&&r.push(e.room),a[t].slots[s].sessions[n].start=getIST(getTimeString(e.start)),a[t].slots[s].sessions[n].end=getIST(getTimeString(e.end))}),a[t].type!=="workshop"&&(a[t].type="conference")}),r.sort(),r.forEach(function(e,t,s){s[t]={name:e,title:getAudiTitle(e),track:t}}),a[t].rooms=r,e.slots.forEach(function(e,s){var n=e.sessions;n.forEach(function(e,n){e.room&&(a[t].slots[s].sessions[n].track=getTrack(e.room,r))})}),a[t].type==="conference"?(n.push({date:a[t].date,tableid:a[t].tableid,rooms:a[t].rooms,start:a[t].start,end:a[t].end}),createTable(n[o]),o+=1):(s.push({date:a[t].date,rooms:a[t].rooms,start:a[t].start,end:a[t].end}),createTable(s[i]),i+=1)}),o=0,i=0,t.forEach(function(e){e.slots.forEach(function(e){e.sessions.length>1&&e.sessions.sort(function(e,t){return e.track-t.track})}),e.type==="conference"?(pushSessions(n[o],e.slots),addRowSpan(n[o]),checkColumns(n[o]),o+=1):(pushSessions(s[i],e.slots),addRowSpan(s[i]),checkColumns(s[i]),i+=1)}),renderScheduleTable(n,"conference"),renderScheduleTable(s,"workshop")}var getDateString=function(e){var t=parseInt(e.substr(0,4),10),s=parseInt(e.substr(5,2),10)-1,n=parseInt(e.substr(8,2),10),o=new Date;return o.setFullYear(t,s,n),o.toDateString()},getTimeString=function(e){return e.substr(e.indexOf("T")+1,5)},getHrMin=function(e){var t=e.substring(0,e.indexOf(":")),s=e.substring(e.indexOf(":")+1);return[t,s]},getdateObject=function(e,t){var s=new Date;return s.setHours(e),s.setMinutes(t),s},toTimeString=function(e){return(10>e.getHours()?"0":"")+e.getHours()+":"+((10>e.getMinutes()?"0":"")+e.getMinutes())},getIST=function(e){var t=parseInt(getHrMin(e)[0],10)+5,s=parseInt(getHrMin(e)[1],10)+30,n=getdateObject(t,s);return ist=toTimeString(n)},createTable=function(e){var t,s,n,o,i;t=getHrMin(e.start)[0],s=getHrMin(e.start)[1],n=getdateObject(t,s),t=getHrMin(e.end)[0],s=getHrMin(e.end)[1],o=getdateObject(t,s),e.slots=[];do i=toTimeString(n),e.slots.push({slot:i,issession:!1,sessions:[],occupied:"empty"}),n.setMinutes(n.getMinutes()+5);while(o>=n)},getTotalMins=function(e){var t=parseInt(getHrMin(e)[0],10),s=parseInt(getHrMin(e)[1],10);return t*60+s},getAudiTitle=function(e){return e.substring(e.indexOf("/")+1).toUpperCase()},getTrack=function(e,t){var s;for(s=0;t.length>s;s++)if(t[s].name===e)return t[s].track},pushSessions=function(e,t){t.forEach(function(t){var s=t.sessions;s.forEach(function(t){var s=getTotalMins(t.start);getTotalMins(t.end),e.slots.forEach(function(e,n,o){getTotalMins(e.slot)===s&&(o[n].sessions.push(t),o[n].issession=!0)})})})},addRowSpan=function(e){e.slots.forEach(function(t,s,n){if(t.issession){(t.sessions[0].track===0||t.sessions[0].is_break)&&(t.occupied=0);var o=t.sessions;for(sessionindex=0;o.length>sessionindex;sessionindex++){var i=getTotalMins(o[sessionindex].end),a=s+1,r=1,c=!1;for(a=s+1;n.length>a;a++){if(n[a].issession===!0&&getTotalMins(n[a].sessions[0].start)>=i)break;n[a].issession===!0&&i>getTotalMins(n[a].sessions[0].start)&&(c=!0,r+=1)}c&&(e.slots[s].sessions[sessionindex].rowspan=r)}}})},checkColumns=function(e){for(var t=0;e.slots.length>t;t++)if(e.slots[t].issession&&e.slots[t].occupied!==0){var s=!1;for(j=t-1;j>0;j--)e.slots[j].issession&&getTotalMins(e.slots[j].sessions[0].end)>getTotalMins(e.slots[t].sessions[0].start)&&(s=!0);if(s===!1){var n=parseInt(getHrMin(e.slots[t].sessions[0].start)[0],10),o=parseInt(getHrMin(e.slots[t].sessions[0].start)[1],10)+5,i=getdateObject(n,o),a=toTimeString(i);e.slots[t].sessions[1]=e.slots[t].sessions[0],e.slots[t].sessions[0]={track:"empty",start:e.slots[t].sessions[1].start,end:a}}}},renderResponsiveTable=function(){$("td.tab-active").attr("colspan",2)},disableResponsiveTable=function(){$("td").not(".centered").attr("colspan","")},compressScheduleTable=function(){},renderScheduleTable=function(e,t){e.forEach(function(e){var s=$("#scheduletemplate").html();t==="conference"?($("#conferenceschedule").append(Mustache.render(s,e)),$(".schedule-table-container p.loadingtxt").hide()):$("#workshopschedule").append(Mustache.render(s,e))}),768>$(window).width()&&renderResponsiveTable()};$(document).ready(function(){$(".site-navbar").length&&$(".site-navbar").offset().top;var e=$(window).width();$(window).resize(function(){e=$(window).width()}),$(window).scroll(function(){$(this).scrollTop()>$("header").height()?$(".site-navbar").addClass("nav-fixed"):$(".site-navbar").removeClass("nav-fixed")}),$("#menu-btn").click(function(){$("#dropdown-menu").hasClass("off")?$("#dropdown-menu").slideDown().removeClass("off"):$("#dropdown-menu").slideUp().addClass("off")}),$(".smooth-scroll").click(function(e){e.preventDefault();var t=$(this).attr("href"),s=$(""+t).offset().top;$("html,body").animate({scrollTop:s},"900")}),$(".turn-right").click(function(){$(this).parent(".box-front-side").addClass("flip").delay(400).queue(function(){$(this).removeClass("show-side").removeClass("flip"),$(this).parents(".box").find(".box-back-side").addClass("show-side"),$(this).clearQueue()})}),$(".turn-left").click(function(){$(this).parent(".box-back-side").addClass("flip").delay(400).queue(function(){$(this).removeClass("show-side").removeClass("flip"),$(this).parents(".box").find(".box-front-side").addClass("show-side"),$(this).clearQueue()})}),setTimeout(function(){$(".heading-text .text1").animate({right:0},500),$(".heading-text .text2").animate({left:0},500)},500);var t="https://juliacon.talkfunnel.com/2015/schedule/json";($("#conferenceschedule").length||$("#workshopschedule").length)&&$.ajax({type:"GET",dataType:"jsonp",url:t,success:function(e){parseJson(e)},error:function(){}}),$(window).resize(function(){768>$(window).width()?renderResponsiveTable():disableResponsiveTable()}),$("#conferenceschedule, #workshopschedule").on("click","table td .expand",function(){$(this).hasClass("fa-chevron-circle-down")?($(this).removeClass("fa-chevron-circle-down").addClass("fa-chevron-circle-up"),$(this).parents("td").find(".description-text").slideDown()):($(this).removeClass("fa-chevron-circle-up").addClass("fa-chevron-circle-down"),$(this).parents("td").find(".description-text").slideUp())}),$("#conferenceschedule, #workshopschedule").on("click","table th.track0, table th.track1, table th.track2",function(){if(768>$(window).width()){var e=$(this).parents("table"),t=$(this).attr("data-td");e.find(".tab-active").removeClass("tab-active"),$(this).addClass("tab-active"),e.find("."+t).addClass("tab-active"),renderResponsiveTable()}}),$(".expand-cancel-form").on("click",function(e){e.preventDefault(),$(".cancel-tickets").hide(),$(".cancelticket-status").html("").hide();var t=$(this).attr("data-target");$(t).slideDown("slow")}),$(".close-form").on("click",function(e){e.preventDefault(),$(this).parents(".cancel-tickets").slideUp(),$(".cancelticket-status").html("").hide()});var s,n='We are sad that you wouldn&#39;t be able to come. Your cancellation request is being processed, you should receive a refund within 7 working days. Feel free to get in touch at <a href="mailto:info@hasgeek.com" class="link-silent softred">info@hasgeek.com</a> for further queries.',o='We are sad that you wouldn&#39;t be able to come. Your transfer request is being processed. Feel free to get in touch at <a href="mailto:info@hasgeek.com" class="link-silent softred">info@hasgeek.com</a> for further queries.';$("#cancelticket, #transferticket").on("submit",function(e){e.preventDefault(),$(".cancelticket-status").html("");for(var t=$(this).serializeArray(),i=!0,a={},r={},c=0;t.length>c;c++)t[c].value===""&&($(".cancelticket-status").html("Please fill all the fields"),i=!1),a[t[c].name]=t[c].value;if(i){a.type==="Cancel"?(s="cancelticket",r={"Order no.":a["order-no"],"Ticket no.":a["ticket-no"],Email:a["ticket-email"],Type:a.type,Event:"JuliaCon India 2015"}):(s="transferticket",r={"Order no.":a["order-no"],"Ticket no.":a["ticket-no"],Email:a["ticket-email"],Type:a.type,"Transferee name":a["transferee-name"],"Transferee email":a["transferee-email"],"Transferee phone":a["transferee-phone"],Event:"JuliaCon India 2015"}),p="Are you sure you want to "+a.type+" your ticket?";var l=window.confirm(p);l&&($(".submit-loader").show(),$.ajax({type:"post",url:"https://script.google.com/macros/s/AKfycbycMp_bW4uj2JmUS4a0ghe7W7xfUzrIP28AV_6wQihg5kX9pDxI/exec",data:r,dataType:"json",timeout:5e3,complete:function(e){$(".submit-loader").hide(),e.status===200?($("#"+s)[0].reset(),s==="cancelticket"?$(".cancelticket-status").show().html(n):$(".cancelticket-status").show().html(o)):$(".cancelticket-status").show().html("Error, try again")}}))}}),$("#subscribe").on("submit",function(e){e.preventDefault(),$(".subscribe-status").html("");var t={};$("#subscribe-email").val()===""?$(".subscribe-status").html("Please enter an email id"):(t={Email:$("#subscribe-email").val(),Event:"JuliaCon India 2016"},$(".ajax-loader").css("visibility","visible"),$.ajax({type:"post",url:"https://script.google.com/macros/s/AKfycbwkkVFfdoQF7_aozgUPyfxDuuxOrN2melaehVBcsuP84Fa7Vks/exec",data:t,dataType:"json",timeout:5e3,complete:function(e){$(".ajax-loader").css("visibility","hidden"),e.status===200?($("#subscribe")[0].reset(),$(".subscribe-status").show().html("Thank you for subscribing!")):$(".subscribe-status").show().html("Error, try again.")}}))})});